# Rime schema
# encoding: utf-8

__include: sbpy.schema.yaml:/

schema:
  schema_id: sbjmzj
  name: 声笔简码整句
  version: "10.0"
  author:
    - 戴石麟 <https://sbxlm.github.io>
    - 蓝落萧 <https://tansongchen.com>
  dependencies:
    - sbpy

switches:
  __include: sbpy.schema.yaml:/switches
  __patch:
    "@3": { options: [fixed, popping], reset: 1, states: [整句, 字词] }

speller:
  __include: sbpy.schema.yaml:/speller
  algebra:
    # 1. 冠零声
    - xform/^(?=[aoe])/v/
    # 2. 去韵母
    - xform/^([a-z])[a-z]+/$1/
    # 3. 补笔画
    - xlit/12345/eiuoa/
    # 4. 出简码
    - derive/^([a-z]{1}).+$/$1/
    - derive/^([a-z]{2}).+$/$1/
    - derive/^([a-z]{3}).+$/$1/
  popping:
    # 纯顶模式，单字、二字词、三字词
    - when: popping
      match: "([bpmfdtnlgkhjqxzcsrywv][aeuio]{0,4}){1,3}[aeiou]+"
      accept: "[bpmfdtnlgkhjqxzcsrywv]"
    # 纯顶模式，四字词和多字词
    - when: popping
      match: "([bpmfdtnlgkhjqxzcsrywv][aeuio]{0,4}){3}([bpmfdtnlgkhjqxzcsrywv]|[bpmfdtnlgkhjqxzcsrywv][aeiou]{2,})"
      accept: "[bpmfdtnlgkhjqxzcsrywv]"

translator:
  __include: sbpy.schema.yaml:/translator
  __patch:
    prism: sbjmzj
